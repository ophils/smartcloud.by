<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional">
<html><head><meta http-equiv="content-type" content="text/html" charset="utf-8">
<title>Остров пингвинов. Делаем сайт</title>
<meta name="description" lang="ru" content="пример сопровождения сайта с использованием классических инструментов Unix: shell, awk, sed, make, m4">
<meta name="description" lang="en" content="site design and support with classic Unix tools: shell, awk, sed, make, m4">
<meta name="keywords" lang="en" content="Linux, Unix, LUG, Gomel, Belarus, ex-USSR, hacker, hacks, Debian, free software, shell, bash, textutils, awk, perl, make, microhack, tricks, tips, russian, debian">
<meta name="keywords" lang="ru" content="Линукс, Юникс, Гомель, Беларусь, пользователи Линукс, дебиан, хаки, хакеры, интернет-технологии, Олег П. Филон, web дизайн">
<meta name="author" content="Олег П. Филон">
<meta name="copyright" content="&copy; FDL, Олег П. Филон">
<link rel="e-mail" href="mailto:ophil44@gmail.com">
<meta name="date" content="2003-05-20">
<meta name="version" content="1.1">
<style type="text/css">
<!--
body, p, div, td, th, tr, form, ol, ul, li, input, textarea, select, a
	{ 	font-family: Verdana,Geneva,Arial,Helvetica,sans-serif;
		font-size: 11pt;
    }
body	{	background: white;
		margin: 3px;
    }
p 	{	display: block;
		text-align: justify;
		line-height: 120%;
		margin: 4px;
    }	
b 	{ 	font-weight: bold;
		color: blue;
    }
pre, code, tt { font: "Courier New", Courier, monospace;
		line-height: 120%;
		font-size: 11pt;
    }

a	{	font-family: Verdana,Geneva,Arial,Helvetica,sans-serif;
		font-size:12pt;
		text-decoration:underline;
		color: blue
    }
a:hover {	color: red
    }
-->
</style>
<script type="text/javascript" language=JavaScript>
<!--
newbie = new Image();
newbie.src="../img/newbie.gif";
guru = new Image();
guru.src="../img/guru.gif";
comm = new Image();
comm.src="../img/forum.gif";
about = new Image();
about.src="../img/about.gif";
-->
</script>

</head><body>
<table cellpadding=0 cellspacing=3 border=0 summary="макет страницы">
<tr valign=top><td><a href=../index.html><img src="../img/topbox.gif" alt="Остров пингвинов"></a></td>
<td height=60 bgcolor="#FFCC33"></td></tr>
<tr><td colspan=2><img src="../img/blue-line.gif" width=600 height=5
alt="- - - - - - - - - - - - - - - - - - - - - - -">
<tr valign=top><td width=131>
<img name="corner" src="../img/articles.gif" width=125 height=91 alt="Сольные выступления"><br><br>
<a href="../articles/newbie.html" onmouseover="document.corner.src='../img/newbie.gif';return true" onmouseout="document.corner.src='../img/articles.gif';return true">Для начинающих</a><br><br>
<a href="../articles/guru.html" onmouseover="document.corner.src='../img/guru.gif';return true" onmouseout="document.corner.src='../img/articles.gif';return true">Для знатоков</a><br><br>
<a href="../articles/community.html" onmouseover="document.corner.src='../img/forum.gif';return true" onmouseout="document.corner.src='../img/articles.gif';return true">Для души</a><br><br>
<a href="../articles/about.html" onmouseover="document.corner.src='../img/about.gif';return true" onmouseout="document.corner.src='../img/articles.gif';return true">О нас</a>
</td><td>

<p>
<strong>Делаем сайт</strong>
<p>
Пора браться за дело. В самом деле, доколе можно. Уж больше трёх лет
как мы с Сашей Качановым сделали этот самый <em>Гомелюг</em>, а что-то так и
стоит недоделанное. Пора также продолжить наш с Сашей спор о некоторых
технических тонкостях web-технологий.
<p>
Тот дизайн страниц, который вы видите в своём браузере, сделан вполне
хорошо, его переделывать нет никакой необходимости. В последние месяцы
прошлого века, когда Саша Качанов по моей просьбе сделал макет нашего
сайта, я вряд ли мог оценить, как просто и интересно можно сверстать
html-страничку, оживить её таким же изящным javasript'ом. С этими
технологиями я в ту пору знаком не был, так что при сочинении статей
приходилось слепо копировать обрамление текста и упорно продираться
через малопонятные html-тэги.
<p>
Согласитесь, что редактировать текст, сочинять его в разметке html,
удовольствие ниже среднего. Вряд ли ситуацию исправят самые лучшие
html-редакторы, если дело касается обычного текста с некоторым минимумом
стилевого оформления. К тому же у тех, кто сочиняет, скорее всего уже
есть привычный удобный редактор текста. Для писателя хотелось бы иметь
нечто не сложнее разметки <em>LaTeX</em>, когда технические детали прячутся
в заголовок документа, автор осваивает только нужные ему стили, чтению
текста не мешают метки параграфов.
<p>
Были проблемы с сопровождением сайта. Приходилось многое делать вручную
- перегонять из одной кодировки в другую, отслеживать обновления
страниц. Что-то изменить в оформлении было так сложно, что это желание
приходилось прятать подальше. Так наш сайт и жил, обростая статьями и
становясь всё менее управляемым. Настоятельно требовалось вмешательство
программиста, квалифицированного посредника между web-дизайнером и
писателем, автором текстов. То, что наш web-мастер, Саша Качанов,
к тому времени был очень далеко, а писатель и программист были одним
и тем же человеком, сути не меняет. Web-среда представляет собой
такое хаотичное нагромождение разных технологий, что для грамотного
сайта нужна квалификация даже не трёх, а гораздо большего количества
специалистов.
<p>
Давайте для интереса подсчитаем, сколько разных технологий надо освоить,
или скольких специалистов привлечь, чтобы сайт не производил удручающее
впечатление малограмотной поделки, не страдал неподъёмными наворотами в
одной из технологий и полным невежеством в других.  Иногда, рассказывая
о многообразии технологий, используемых для создания web-сайта, я называю
эти технологии пятислойными:
<ol>
<li> язык разметки HTML, стилевые таблицы CSS
<li> программирование на стороне клиента - JavaScript, Java
<li> протокол HTTP, конфигурация сервера Apache, анализ логов
<li> программирование на стороне сервера - SSI, CGI, PHP, Perl
<li> работа с реляционной СУБД, язык SQL
</ol>
<p>
Возможно, не все из перечисленных технологий нужны для простейшего
сайта, но, с другой стороны, сколько сложностей остались за пределами
этой упрощённой модели - разные версии языков, нестандартные расширения
в браузерах, сопровождение сайта.  Удивительно, как эта Вавилонская
башня самой популярной технологии инета ещё строится, несмотря на
подобное столпотворение языков и конкуренцию между отдельными влиятельными
участниками. Уверенно можно сказать - ни одна из программ, сколько бы
она ни стоила и как бы продавцы её не расхваливали, не может вместить
всё многообразие этих технологий, не избавит вас от необходимости их
понимать и следить за их развитием.
<p>
Вернёмся, однако, к нашему <em>Гомелюгу</em>. Что мне хотелось переделать с
самого начала - это уменьшить количество картинок на странице и добавить
ещё одну, с <em>usemap</em>, в низ каждой страницы, т.н. подножие, footer.
Уменьшить количество картинок в данном случае можно было совершенно не
трогая дизайн страницы. По чьему-то неграмотному совету Саша разбил одну
большую картинку с пингвинами на 7 меньших. Якобы это должно было ускорить
загрузку страницы. К сожалению, автор подобного совета имеет очень слабое
представление о работе протокола HTTP. Для загрузки каждого объекта на
странице - самого html-документа, каждой картинки, файла стиля, скрипта -
создаётся новое соединение с довольно большими накладными расходами. Для
того, чтобы передать в браузер крошечную однопиксельную картинку, нужно,
как минимум, клиенту и серверу обменяться почти десятком IP-пакетов,
итого немногим менее одного килобайта. Создаётся ненужная нагрузка на
сервер, логи забиваются бесполезной информацией.  Грамотный сисадмин,
правда, может настроить Apache не записывать в журнал передачу некоторых
типов файлов.
<p>
Итак, переделку сайта мы начинаем с тщательного его анализа -
как устроена страница, какие части общие для всех документов, как
сохранить рубрики и каталоги. Для многих сайтов, и нашего в том числе,
уже простейшая серверная технология - SSI (Server Side Include), с её
десятком элементарных команд, позволяет разбить страницы на составные
части и задать динамическую, при обращении, сборку готовой страницы.
<p>
Пойдём сразу немного дальше. Почему бы для нашего статичного сайта
не сделать сборку из отдельных кусков страницы здесь, на месте,
например, скриптом и утилитой <tt>make</tt>. Можно также научить скрипт
преобразовывать некоторые строки из обычного текста в html-заголовки.
Документ <em>RFC0822</em>, определяющий стандарт для почтовых сообщений,
даёт пример организации текстового документа наподобие полей в базе
данных. Таким же образом мы укажем в документе поле:
<blockquote><pre>
Title: Остров пингвинов. Делаем сайт
</pre></blockquote>
<p>
а в скрипте сделаем преобразование этого поля в html-вид:
<blockquote><pre>
awk '/^Title: /{print "&lt;title&gt;"substr($0,8)"&lt;/title&gt;"}'
</pre></blockquote>
<p>
Т.е. я хочу организовать содержимое сайта в виде текстовых документов с
некоторыми элементами базы данных. Эту же задачу пытаются решить многие
проекты, используя технологию XML и многочисленные наборы скриптов.
Похоже, развитие технологии XML испытывает серьёзный кризис. Об этом
говорит чрезмерное многообразие инструментов и языков, их возрастающая
сложность.  Одна из попыток совместить в одном документе легко читаемый
текст и также легко извлекаемые поля для БД реализована в проекте
<a href="http://yaml.org">yaml.org</a>. Кстати, этот проект использует формат,
напоминающий всё тот же <em>RFC0822</em>.
<p>
Продолжаем упрощать жизнь авторов текстов. Подобно приведенному, можно
завести поля для всех тэгов из заголовка html-документа. Точно также,
в новый, RFC0822-совместимый заголовок документа можно вставить имя
стилевого файла, javascript-файла, header'а, footer'а. Очень часто в
дизайне страницы используется таблица, разбивающая страницу на области
заголовка, меню, собственно текста. Её также можно поместить в отдельный
файл и включать в готовую страницу скриптом.
<p>
Включая стилевую CSS-таблицу и текст javascript'а непосредственно в
документ html, мы решаем сразу две проблемы. Во-первых, немного повышается
эффективность пересылки страницы клиенту. Помните, протокол HTTP открывает
новое соединение для каждого объекта, а здесь есть возможность включить текст
стиля и скрипта непосредственно в файл. А во-вторых, нашу страницу будет легче
копировать на компьютер клиента, если, конечно, вы хотите облегчить эту
процедуру.
<p>
Полезно включить в наш скрипт приятную мелочь из языка TeX - отделять
параграфы друг от друга пустой строкой. Замена пустой строки на тэг
&lt;p&gt; - пустяк для скрипта, а редактировать текст станет гораздо
приятнее. Пора, наверное, взглянуть на этот скрипт повнимательнее,
вот он весь : <a href="../text2html">text2html</a>.
<p>
Имея скрипт для компиляции обычного, удобного для редактирования текста,
с элементами БД, в результирующий html-код, перейдём к следующему шагу -
создадим <tt>Makefile</tt> для автоматизации сопровождения сайта. Обычно
утилита <tt>make</tt> используется для сборки программ из исходного кода.
На самом деле эта утилита хорошо подходит для решения сразу двух
задач. Первая задача - отслеживание зависимостей одних файлов от других,
например, при изменении документа пересобрать соответствующую страницу.
Вторая задача, легко реализуемая через <tt>make</tt> - собрать в один файл
много мелких скриптов, удобно их организовать. Как правило, загрузка сайта
на сервер, удаление временных файлов, и прочее, делается несколькими
рутинными командами. В <tt>Makefile</tt>'е эта группа команд называется
<em>целью</em>, она указывается при вызове <tt>make</tt>.
<p>
Утилита <tt>make</tt> хорошо документирована, многократно растолкована
в примерах. Можете посмотреть на мой <a href="../Makefile">Makefile</a>.
Но возможно, будет интереснее увидеть весь <a href="../gulag-arc.tgz">сайт
с набором скриптов</a>. Скрипты и программки распространяются по лицензии
<a href="GPL.rus.html">GPL(русский перевод)</a>, а весь сайт прошу использовать
всех желающих соблюдая лицензию <em>FDPL</em>.
<p>
Но прежде чем изучать исходный текст сайта и скрипты, поговорим ещё
на одну тему - а нельзя ли усовершенствовать язык html, дать автору
ещё более простые конструкции для разметки документа. По этому поводу
откроем ещё один документ - <a href="perfect-site.html">"Совершенствуем сайт"</a>.
</td></tr><tr><td colspan=2 align=center>
<img src=../img/footer.gif border=0 usemap=#gulag alt="Олег Филон, Дм. Федорович, Ал-др Качанов">
<map name=gulag>
<area shape="rect" coords="0,10,130,25" href=../articles/articles.html alt="Статьи Олега Филона" title=ophil>
<area shape="rect" coords="0,25,51,37" href=../articles/articles.html alt="Статьи Олега Филона" title=ophil>
<area shape="rect" coords="140,25,317,40" href=http://www.stihi.ru/avtor/fedorovich alt="Литературная страница Дм. Федоровича" title=df>
<area shape="rect" coords="60,40,317,55" href=http://www.stihi.ru/avtor/fedorovich alt="Литературная страница Дм. Федоровича" title=df>
<area shape="rect" coords="290,5,440,20" href=http://www.webmascon.com alt="дизайн А. Качанова" title=community>
<area shape="rect" coords="343,20,440,38" href=http://www.webmascon.com alt="дизайн А. Качанова" title=community>
<area shape="default" href=../articles/articles.html alt="Статьи Олега Филона" title=ophil>
</map></td></tr>
</table>
</body>
</html>
